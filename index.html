<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no,user-scalable=no,maximum-scale=1">

    <link rel="icon" type="image/png" href="images/conix-x.png">

    <title>ARENA</title>
    <meta name="description" content="Augmented Reality Edge Networking Architecture">

    <!-- jquery, needed by lib jitsi -->
    <script src="vendor/jquery-2.1.1.min.js"></script>

    <!-- lib jitsi -->
    <script src="vendor/strophe/strophe.js"></script>
    <script src="vendor/strophe/strophe.disco.min.js?v=1"></script>
    <script src="vendor/lib-jitsi-meet.min.js"></script>

    <!-- our default configs -->
    <script src="conf/defaults.js"></script>

    <!-- main arena bundle -->
    <script src="dist/arena-core.js"></script>
    <!-- main arena stylesheet -->
    <link rel="stylesheet" href="dist/arena-core.css">

    <!-- face tracking -->
    <script src="src/face-tracking/dist/face-tracker.min.js"></script>
    <script src="src/face-tracking/script.js"></script>

    <!-- 2D UI -->
    <link href="vendor/mdb/mdb.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="vendor/fontawesome/all.min.css"/>
  </head>
  <body>
  <!-- A/V Setup -->
  <div class="d-none d-flex align-items-center min-vh-100" id="avSetup">
    <div class="container">
      <div class="row d-flex justify-content-center align-items-center">
        <div class="col-lg-8 p-5 col-md-10 shadow rounded bg-white">
          <div class="row mb-3">
            <div class="col">
              <button class="float-end btn btn-sm btn-outline-primary" id="redetectAVBtn">
                Re-detect Devices <i class="fas fa-sync"></i>
              </button>
              <h3><img alt="CONIX Logo" class="title-logo" src="images/xr-logo-v7.png"/> Setup</h3>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-7 mb-md-0 mb-3">
              <div>
                <video autoplay class="w-100 h-auto" id="vidPreview" muted playsinline></video>
              </div>
            </div>
            <div class="col-md-5">
              <div class="form-floating mb-3">
                <select aria-label="Video Source" class="form-select mb-3" id="vidSourceSelect">
                </select>
                <label for="vidSourceSelect">Select Video Device</label>
              </div>
              <div class="form-floating">
                <select aria-label="Speaker Device" class="form-select mb-3" id="audioOutSelect">
                  <option selected>No Device Detected</option>
                </select>
                <label for="audioOutSelect">Select Speaker Device</label>
              </div>
              <button class="btn btn-sm btn-outline-primary mb-3" id="playTestAudioOutBtn">
                Play Test Sound <i id="playTestAudioOutIcon" class="fas fa-volume-off"></i>
              </button>
              <audio id="testAudioOut" src="media/step.ogg"></audio>
              <div class="form-floating mb-3">
                <select aria-label="Microphone Device" class="form-select mb-3" id="audioSourceSelect">
                </select>
                <label for="audioSourceSelect">Select Microphone Device</label>
              </div>
              <div class="progress" style="height: 10px;">
                <div
                        aria-valuemax="100"
                        aria-valuemin="0"
                        aria-valuenow="0"
                        class="progress-bar progress-bar-striped bg-success"
                        role="progressbar"
                        style="width: 0"
                        id="micMeter"
                ></div>
              </div>
              <!-- Ref https://github.com/cwilso/volume-meter/ !-->
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="form-outline mb-3" id="displayName-input">
                <input class="form-control" id="displayName" type="text">
                <label class="form-label" for="displayName">Display Name</label>
              </div>
              <div class="input-group mb-3">
                <span class="input-group-text">Scene URL</span>
                <input
                        aria-label="Scene URL"
                        class="form-control"
                        id="sceneURL"
                        readonly
                        type="text"
                />
                <button class="btn btn-primary" id="enterSceneAVBtn">Enter</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <a-scene background="color: black" name="ARENAScene" webxr="optionalFeatures: hit-test, dom-overlay, computerVision; overlayElement: overlay;" stats="false">  <!-- stats physics -->
      <a-assets>
        <!-- Vive controller 3d model -->
        <!-- <a-asset-item id="viveControl-obj" src="models/vr_controller_vive.obj"></a-asset-item>
        <a-asset-item id="viveControl-mtl" src="models/vr_controller_vive.mtl"></a-asset-item> -->
      </a-assets>

      <a-entity id="sceneRoot">
        <!-- ground plane so falling objects don't fall through floor -->
        <a-plane static-body position="0 -0.1 0" id="groundPlane" collision-listener color="#FFAAEE" transparent="true" opacity=".01" height="30" width="30" rotation="-90 0 0"></a-plane>

        <!-- walls so rolling objects don't roll off edge -->
        <a-box static-body position="-15 1 0" id="border1" color="#111111" transparent="true" opacity=".01" scale="0.5 0.5 30"></a-box>
        <a-box static-body position="15 1 0" id="border2" color="#111111" transparent="true" opacity=".01" scale="0.5 0.5 30"></a-box>
        <a-box static-body position="0 1 15" id="border3" color="#111111" transparent="true" opacity=".01" scale="30 0.5 0.5"></a-box>
        <a-box static-body position="0 1 -15" id="border4" color="#111111" transparent="true" opacity=".01" scale="30 0.5 0.5"></a-box>

        <a-entity position="0 0 0" id="cameraRig">
          <a-entity position="0 0 0" id="cameraSpinner" name="PerspectiveCamera" tag="MainCamera">
            <!-- this camera can 'fly': z axis follows pitch of head direction -->
            <a-camera id="my-camera" far="10000" near="0.1" wasd-controls="fly: false; acceleration: 30" look-controls="reverseMouseDrag: true" look-controls-arrow mouse-cursor press-and-move network-latency>
              <a-entity id="mouse-cursor" cursor="rayOrigin: mouse" raycaster="objects:[click-listener]"></a-entity>
            </a-camera>
          </a-entity>
        </a-entity>

        <!-- <a-entity vive-listener vive-pose-listener id="vive-leftHand" laser-controls="hand:left" raycaster="objects: [click-listener]"></a-entity>
        <a-entity vive-listener vive-pose-listener id="vive-rightHand" laser-controls="hand:right" raycaster="objects: [click-listener]"></a-entity> -->
      </a-entity>
    </a-scene>

    <video src="" id="localVideo" muted="muted" volume="0" autoplay="true" playsinline="true" crossorigin="anonymous"></video>

    <div id="gltf-loading"></div>

    <!-- login auth check with calls to mqtt connect placed in an `onauth` event listener -->
    <script src="vendor/jsrsasign-all-min.js" type="text/javascript"></script>
    <script src="src/auth.js"></script>
    <script type="text/javascript">authCheck();</script>

    <!-- 2D UI -->
    <script src="vendor/mdb/mdb.min.js"></script>

    <!-- Mic setup audio processing -->
    <script src="vendor/volume-meter.js"></script>
  </body>
</html>

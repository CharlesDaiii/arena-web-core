{"version":3,"sources":["web-xr-viewer.js"],"names":["importScript","path","entry","window","__db","undefined","escape","replace","script","Object","assign","document","createElement","type","textContent","promise","Promise","resolve","reject","onerror","head","appendChild","remove","addEventListener","e","sceneEl","querySelector","is","isWebXRViewer","lastMouseTarget","navigator","userAgent","includes","base64script","onload","ARENAUtils","src","el","ARENA","sceneObjects","elPos","THREE","Vector3","object3D","getWorldPosition","intersection","x","y","z","emit","camName","point","cursor","getElementById","cursorParent","parentNode","removeChild","setAttribute"],"mappings":";AAOA,SAASA,EAAaC,GACdC,IAAAA,EAAQC,OAAOH,aAAaI,KAAKH,GACjCC,QAAUG,IAAVH,EAAqB,CACfI,MAAAA,EAASL,EAAKM,QAAS,IAAK,OAC5BC,EAASC,OAAOC,OAAOC,SAASC,cAAc,UAAW,CAC3DC,KAAM,SACNC,mCAAoCR,0BAA+BA,qBAEvEJ,EAAQF,EAAaI,KAAKH,GAAQ,IAC5Bc,QAAU,IAAIC,QAAQ,CAACC,EAASC,KAClChB,EAAMe,QAAUA,EAChBT,EAAOW,QAAUD,IAErBP,SAASS,KAAKC,YAAYb,GAC1BA,EAAOc,SAEJpB,OAAAA,EAAMa,QAEjBf,EAAaI,KAAO,GACpBD,OAAM,aAAmBH,EAEzBG,OAAOoB,iBAAiB,WAAY,SAASC,GAErCC,GADYd,SAASe,cAAc,WAC3BC,GAAG,WAAY,CAInBC,GAHJzB,OAAO0B,qBAAkBxB,EACHyB,UAAUC,UAAUC,SAAS,eAEhC,CACTC,MAAAA,EAAetB,SAASC,cAAc,UAC5CqB,EAAaC,OAAS,iBACZC,WAAWnC,aAAa,8BAElCiC,EAAaG,IAAM,kCACnBzB,SAASS,KAAKC,YAAYY,GAG1BtB,SAASY,iBAAiB,YAAa,SAASC,GACxCrB,GAAAA,OAAO0B,gBAAiB,CAClBQ,MAAAA,EAAKlC,OAAOmC,MAAMC,aAAapC,OAAO0B,iBACtCW,EAAQ,IAAIC,MAAMC,QACxBL,EAAGM,SAASC,iBAAiBJ,GAEvBK,MAAAA,EAAe,CACjBC,EAAGN,EAAMM,EACTC,EAAGP,EAAMO,EACTC,EAAGR,EAAMQ,GAEbX,EAAGY,KAAK,YAAa,CACN9C,QAAAA,OAAOmC,MAAMY,QACR,aAAA,CACZC,MAAON,GAEC,UAAA,IACb,MAIXlC,SAASY,iBAAiB,UAAW,SAASC,GACtCrB,GAAAA,OAAO0B,gBAAiB,CAClBQ,MAAAA,EAAKlC,OAAOmC,MAAMC,aAAapC,OAAO0B,iBACtCW,EAAQ,IAAIC,MAAMC,QACxBL,EAAGM,SAASC,iBAAiBJ,GACvBK,MAAAA,EAAe,CACjBC,EAAGN,EAAMM,EACTC,EAAGP,EAAMO,EACTC,EAAGR,EAAMQ,GAEbX,EAAGY,KAAK,UAAW,CACJ9C,QAAAA,OAAOmC,MAAMY,QACR,aAAA,CACZC,MAAON,GAEC,UAAA,IACb,MAKPO,IAAAA,EAASzC,SAAS0C,eAAe,eAC/BC,MAAAA,EAAeF,EAAOG,WAC5BD,EAAaE,YAAYJ,IACzBA,EAASzC,SAASC,cAAc,aACzB6C,aAAa,QAAQ,GAC5BL,EAAOK,aAAa,QAAS,eAC7BL,EAAOK,aAAa,WAAY,YAChCL,EAAOK,aAAa,QAAS,QAC7BL,EAAOK,aAAa,eAAgB,SACpCL,EAAOK,aAAa,KAAM,eAC1BH,EAAajC,YAAY+B,GAE7BzC,SAAS0C,eAAe,OAAOI,aAAa,WAAW","file":"web-xr-viewer.4d0c1b26.js","sourceRoot":"../src","sourcesContent":["/**\n * Dynamically import js script\n * usage:\n *   importScript('./path/to/script.js').then((allExports) => { .... }));\n * @param {string} path path of js script\n * @return {promise}\n */\nfunction importScript(path) {\n    let entry = window.importScript.__db[path];\n    if (entry === undefined) {\n        const escape = path.replace(`'`, `\\\\'`);\n        const script = Object.assign(document.createElement('script'), {\n            type: 'module',\n            textContent: `import * as x from '${escape}'; importScript.__db['${escape}'].resolve(x);`,\n        });\n        entry = importScript.__db[path] = {};\n        entry.promise = new Promise((resolve, reject) => {\n            entry.resolve = resolve;\n            script.onerror = reject;\n        });\n        document.head.appendChild(script);\n        script.remove();\n    }\n    return entry.promise;\n}\nimportScript.__db = {};\nwindow['importScript'] = importScript; // needed if we ourselves are in a module\n\nwindow.addEventListener('enter-vr', function(e) {\n    const sceneEl = document.querySelector('a-scene');\n    if (sceneEl.is('ar-mode')) {\n        window.lastMouseTarget = undefined;\n        const isWebXRViewer = navigator.userAgent.includes('WebXRViewer');\n\n        if (isWebXRViewer) {\n            const base64script = document.createElement('script');\n            base64script.onload = async () => {\n                await ARENAUtils.importScript('./src/apriltag/script.js');\n            };\n            base64script.src = './src/apriltag/base64_binary.js';\n            document.head.appendChild(base64script);\n\n            // handle tap events\n            document.addEventListener('mousedown', function(e) {\n                if (window.lastMouseTarget) {\n                    const el = window.ARENA.sceneObjects[window.lastMouseTarget];\n                    const elPos = new THREE.Vector3();\n                    el.object3D.getWorldPosition(elPos);\n\n                    const intersection = {\n                        x: elPos.x,\n                        y: elPos.y,\n                        z: elPos.z,\n                    };\n                    el.emit('mousedown', {\n                        'clicker': window.ARENA.camName,\n                        'intersection': {\n                            point: intersection,\n                        },\n                        'cursorEl': true,\n                    }, false);\n                }\n            });\n\n            document.addEventListener('mouseup', function(e) {\n                if (window.lastMouseTarget) {\n                    const el = window.ARENA.sceneObjects[window.lastMouseTarget];\n                    const elPos = new THREE.Vector3();\n                    el.object3D.getWorldPosition(elPos);\n                    const intersection = {\n                        x: elPos.x,\n                        y: elPos.y,\n                        z: elPos.z,\n                    };\n                    el.emit('mouseup', {\n                        'clicker': window.ARENA.camName,\n                        'intersection': {\n                            point: intersection,\n                        },\n                        'cursorEl': true,\n                    }, false);\n                }\n            });\n\n            // create psuedo-cursor\n            let cursor = document.getElementById('mouseCursor');\n            const cursorParent = cursor.parentNode;\n            cursorParent.removeChild(cursor);\n            cursor = document.createElement('a-cursor');\n            cursor.setAttribute('fuse', false);\n            cursor.setAttribute('scale', '0.1 0.1 0.1');\n            cursor.setAttribute('position', '0 0 -0.1'); // move reticle closer (side effect: bigger!)\n            cursor.setAttribute('color', '#333');\n            cursor.setAttribute('max-distance', '10000');\n            cursor.setAttribute('id', 'fuse-cursor');\n            cursorParent.appendChild(cursor);\n        }\n        document.getElementById('env').setAttribute('visible', false);\n    }\n});\n"]}